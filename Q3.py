import numpy as np
import sys
from xclib.data import data_utils
import timeit
import matplotlib.pyplot as plt
from sklearn.ensemble import RandomForestClassifier

train_x = sys.argv[1]
train_y = sys.argv[2]
valid_x = sys.argv[3]
valid_y = sys.argv[4]
test_x = sys.argv[5]
test_y = sys.argv[6]
  
X = data_utils.read_sparse_file(train_x, force_header=True)
X=X.todense()
with open(train_y) as f1:
    Y = np.genfromtxt(f1)
    
vX = data_utils.read_sparse_file(valid_x, force_header=True)
vX=vX.todense()
with open(valid_y) as f1:
    vY = np.genfromtxt(f1)
    
tX = data_utils.read_sparse_file(test_x, force_header=True)
tX=tX.todense()
with open(test_y) as f1:
    tY = np.genfromtxt(f1)   
    
n_estimators_list=[50,150,250,350,450]
max_features_list=[0.2,0.4,0.6,0.8,1.0]    
min_samples_split_list=[2,4,6,8,10]

#print('parameters: n_estimators,max_features,min_samples_split','\t','oob score:')

i=450
j=0.6
k=10

test_list=[]
valid_list=[]

#for i in n_estimators_list:
#    for j in max_features_list:
#        for k in min_samples_split_list:


#starttime = timeit.default_timer()     
clf = RandomForestClassifier(criterion = "entropy", n_estimators=i, bootstrap = True, oob_score=True , max_features =j, min_samples_split=k)      
clf.fit(X,Y)

#print("training time:")    
#print(timeit.default_timer()-starttime)
#print(i,j,k,'\t',clf.oob_score_)

#print("train accuracy:")
#accuracy = clf.score(X,Y)
#print(accuracy)

print("validation accuracy:")    
accuracy = clf.score(vX,vY)
print(accuracy)
#valid_list.append(accuracy)

print("test accuracy")    
accuracy = clf.score(tX,tY)
print(accuracy)
#test_list.append(accuracy)
    
#450 0.6 10       0.8103781311328481
##    (b)    
#plt.plot(n_estimators_list,valid_list,'-o',label='validation')
#plt.plot(n_estimators_list,test_list,'-o',label='test')
#plt.xlabel('n_estimators')
#plt.ylabel('data')
#plt.legend()
##plt.savefig("n_estimators.png",bbox_inches="tight")
#plt.show()



#50 0.2 2         0.7994684221099315
#50 0.2 4         0.8016472733453865
#50 0.2 6         0.8041969928762381
#50 0.2 8         0.8067930709440143
#50 0.2 10        0.806901240863505
#50 0.4 2         0.7989121196668366
#50 0.4 4         0.8010291595197255
#50 0.4 6         0.8032698221377467
#50 0.4 8         0.8055877489839754
#50 0.4 10        0.8057113717491076
#50 0.6 2         0.7988812139755536
#50 0.6 4         0.8002874229289324
#50 0.6 6         0.8040733701111059
#50 0.6 8         0.8049232766213898
#50 0.6 10        0.8061285985814288
#50 0.8 2         0.7984330814519494
#50 0.8 4         0.8004883099222722
#50 0.8 6         0.803161652218256
#50 0.8 8         0.8031461993726144
#50 0.8 10        0.8045987668629178
#50 1.0 2         0.7978613261632129
#50 1.0 4         0.8005501213048383
#50 1.0 6         0.8014927448889713
#50 1.0 8         0.8031307465269729
#50 1.0 10        0.8037025018157093
#150 0.2 2        0.8010291595197255
#150 0.2 4        0.8047378424736915
#150 0.2 6        0.8066385424875991
#150 0.2 8        0.8076120717630152
#150 0.2 10       0.8085083368102236
#150 0.4 2        0.8012918578956315
#150 0.4 4        0.8041660871849551
#150 0.4 6        0.8067930709440143
#150 0.4 8        0.8078593172932795
#150 0.4 10       0.8079365815214872
#150 0.6 2        0.8014000278151222
#150 0.6 4        0.8030534822987653
#150 0.6 6        0.8059740701250135
#150 0.6 8        0.8072102977763355
#150 0.6 10       0.8091264506358846
#150 0.8 2        0.8005501213048383
#150 0.8 4        0.8030534822987653
#150 0.8 6        0.804753295319333
#150 0.8 8        0.8073030148501846
#150 0.8 10       0.8082147327430347
#150 1.0 2        0.7993757050360824
#150 1.0 4        0.8027444253859348
#150 1.0 6        0.8043206156413704
#150 1.0 8        0.8046605782454839
#150 1.0 10       0.8074420904609584
#250 0.2 2        0.8019717831038585
#250 0.2 4        0.8051705221516542
#250 0.2 6        0.8074729961522414
#250 0.2 8        0.808786488031771
#250 0.2 10       0.8097445644615456
#250 0.4 2        0.8026980668490102
#250 0.4 4        0.8049078237757483
#250 0.4 6        0.8079983929040533
#250 0.4 8        0.8089410164881863
#250 0.4 10       0.8093273376292244
#250 0.6 2        0.8030225766074822
#250 0.6 4        0.8049387294670314
#250 0.6 6        0.8058195416685983
#250 0.6 8        0.8081529213604686
#250 0.6 10       0.8097136587702626
#250 0.8 2        0.8012918578956315
#250 0.8 4        0.8041197286480305
#250 0.8 6        0.8058813530511644
#250 0.8 8        0.8075502603804491
#250 0.8 10       0.8080447514409779
#250 1.0 2        0.7999629131704603
#250 1.0 4        0.8017399904192357
#250 1.0 6        0.8038261245808416
#250 1.0 8        0.8062058628096364
#250 1.0 10       0.8074111847696753
#350 0.2 2        0.8029298595336332
#350 0.2 4        0.8062213156552779
#350 0.2 6        0.808137468514827
#350 0.2 8        0.8095900360051304
#350 0.2 10       0.8103317725959236
#350 0.4 2        0.8027289725402933
#350 0.4 4        0.8052323335342203
#350 0.4 6        0.8077975059107134
#350 0.4 8        0.8091109977902431
#350 0.4 10       0.8091728091728092
#350 0.6 2        0.8023735570905383
#350 0.6 4        0.8048151067018992
#350 0.6 6        0.807225750621977
#350 0.6 8        0.8081992798973932
#350 0.6 10       0.8086783181122804
#350 0.8 2        0.802219028634123
#350 0.8 4        0.8037952188895585
#350 0.8 6        0.8063449384204101
#350 0.8 8        0.8080911099779025
#350 0.8 10       0.8082765441256007
#350 1.0 2        0.8009518952915179
#350 1.0 4        0.8032698221377467
#350 1.0 6        0.8054023148362771
#350 1.0 8        0.8062522213465609
#350 1.0 10       0.8086010538840728
#450 0.2 2        0.8024971798556704
#450 0.2 4        0.8064376554942593
#450 0.2 6        0.8085856010384312
#450 0.2 8        0.8093427904748659
#450 0.2 10       0.8095591303138473
#450 0.4 2        0.8031307465269729
#450 0.4 4        0.8055104847557678
#450 0.4 6        0.8084001668907329
#450 0.4 8        0.8083229026625253
#450 0.4 10       0.8093582433205074
#450 0.6 2        0.8029607652249162
#450 0.6 4        0.8045524083259933
#450 0.6 6        0.8076738831455813
#450 0.6 8        0.8079365815214872
#450 0.6 10       0.8103781311328481
#450 0.8 2        0.8018327074930849
#450 0.8 4        0.8049387294670314
#450 0.8 6        0.8049387294670314
#450 0.8 8        0.8079056758302041
#450 0.8 10       0.8088328465686956
#450 1.0 2        0.8010755180566501
#450 1.0 4        0.8032698221377467
#450 1.0 6        0.8052477863798618
#450 1.0 8        0.8061131457357873
#450 1.0 10       0.8084774311189405